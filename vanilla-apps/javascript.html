<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Javascript</title>
</head>
<body>
    <div controller="InputController">
        <input id="inputOne" bind="one"/>
        <input id="inputOneBis" bind="one"/>
        <input id="inputTwo" bind="two"/>
    </div>

    <script>
        (function () {
            var self = {};
            self.controllers = {};

            var instanceController = function (name) {
                var ctrl = new self.controllers[name].factory;
                self.controllers[name].instances.push(ctrl);
                return ctrl;
            };
            var scanTemplateForController = function (name) {
                return document.querySelector('[controller=' + name + ']');
            };
            var instanceControllerForElement = function (element) {
                var ctrl = instanceController(element.getAttribute('controller'));

                // Récupère les valeurs de bind et les élements auxquels binder
                var bindings =  {};
                Array.prototype.slice.call(element.querySelectorAll('[bind]'))
                    .map(function (element) {
                        var bindedValue = element.getAttribute('bind');

                        if(!bindings[bindedValue]) {
                            bindings[bindedValue] = {
                                bindedValue: bindedValue,
                                elements: []
                            }
                        }

                        bindings[bindedValue].elements.push(element);
                    });

                // Proxy pour changement de valeur en JS
                var proxy = new Proxy(ctrl, {
                    set: function (target, prop, value) {
                        var bind = bindings[prop];
                        // Met à jour le DOM de chaque élément bindé à cette valeur
                        bind.elements.forEach(function (element) {
                            element.value = value;
                            element.setAttribute('value', value);
                        });
                        return Reflect.set(target, prop, value);
                    }
                });

                // Listeners pour changement de valeur DOM
                Object.keys(bindings).forEach(function (bindedValue) {
                    var bind = bindings[bindedValue];
                    bind.elements.forEach(function (element) {
                        element.addEventListener('input', function (event) {
                            proxy[bind.bindedValue] = event.target.value;
                        });
                    })
                });

                return ctrl;
            };

            self.addController = function (name, value) {
                self.controllers[name] = {
                    factory: value,
                    instances: []
                };

                var elementWithController = scanTemplateForController(name);
                if(elementWithController) {
                    return instanceControllerForElement(elementWithController);
                }
            };

            this.angular = {
                controller: self.addController
            };
        })();
    </script>
    <script>
        (function () {
            function InputController () {
                this.one = 'Hello';
                this.two = 'World';
            }
            this.inputController = angular.controller('InputController', InputController);
        })();
    </script>
</body>
</html>